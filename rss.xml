<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[anthu.dev]]></title><description><![CDATA[Personal blog about cloud, DevOps and stuff.]]></description><link>https://anthu.dev</link><generator>GatsbyJS</generator><lastBuildDate>Sun, 19 Dec 2021 21:31:14 GMT</lastBuildDate><item><title><![CDATA[Azure DevOps: Get short commit hash in build pipeline]]></title><description><![CDATA[When building potentially deployable artifacts as part of the build pipeline it’s crutical to identify each produced artifact based on the…]]></description><link>https://anthu.dev/2020-04-18-azure-devops-short-commithash/</link><guid isPermaLink="false">https://anthu.dev/2020-04-18-azure-devops-short-commithash/</guid><pubDate>Mon, 27 Jul 2020 07:26:03 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;When building potentially deployable artifacts as part of the build pipeline it’s crutical to identify each produced artifact based on the source of the build. Helpful tracers I’m using are branch name, commithash and the build number. In my current project I’m using Azure DevOps Pipelines for building and they provide a lot of helpful predefined variables (find a full list &lt;a href=&quot;https://docs.microsoft.com/en-us/azure/devops/pipelines/build/variables?view=azure-devops&amp;#x26;tabs=yaml&quot;&gt;here&lt;/a&gt;). Anyway there is one variable I’m missing: short commit hash.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Of course Microsoft could provide this variable out of the box but I also get the point that requirements are highly different. While I prefer the 8-char long hash other might be happy with seven or ten characters. I will show you that it’s not that complicated to trim your own commit hash and share the snippet I’m using for almost every pipeline:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- powershell: |
    $shortHash = $env:BUILD_SOURCEVERSION.subString(0, 7)
    Write-Host &amp;quot;##vso[task.setvariable variable=shortHash]$shortHash&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In bash it’s even easier:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- powershell: |
    echo &amp;quot;##vso[task.setvariable variable=shortHash]${BUILD_SOURCEVERSION:0:7}&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And this is how you can use it in you pipeline later (remember that the template experession syntax ${{shortHash}} won’t work as the variable needs to be evaluated at runtime)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- task: DotNetCoreCLI@2
    displayName: Publish .NET Application
    inputs:
    command: &amp;#39;publish&amp;#39;
    arguments: &amp;#39;--configuration &amp;#39;Release&amp;#39; --output $(Build.ArtifactStagingDirectory) --version-suffix $(shortHash)-$(Build.BuildNumber)&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item></channel></rss>